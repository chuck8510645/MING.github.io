<!DOCTYPE html>
<html lang="en">

<head>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <style>
        .btn_class {
            position: relative;
            cursor: pointer;
            top: 0px;
            left: 200px;
            width: 30px;
            height: 30px;
            background-color: rgba(161, 160, 160, 0.877);
            border: 0;
            border-radius: 5px;
            font-size: 25px;
            outline: none;
            margin: 1px;
            padding: 2px;
        }

        #restartbtn {
            position: absolute;
            cursor: pointer;
            background-color: rgba(161, 160, 160, 0.877);
            border: 0;
            border-radius: 5px;
            top: 350px;
            left: 665px;
            width: 110px;
            height: 50px;
            font-size: 20px;
            outline: none;
        }

        #start {
            position: absolute;
            cursor: pointer;
            outline: none;
            background-color: rgba(161, 160, 160, 0.877);
            border: 0;
            border-radius: 5px;
            top: 220px;
            left: 100px;
            height: 30px;
            width: 60px;
        }

        #Next_player {
            position: relative;
            font-size: 25px;
            left: 210px;
        }

        #player {
            font-size: 25px;
            width: 20px;
        }

        #win_arrow {
            position: absolute;
            font-size: 25px;
            color: rgba(85, 85, 85);
            top: 265px;
            left: 650px;
        }

        div {
            display: inline-block
        }

        #win_X,
        #win_O {
            position: relative;
            height: 30px;
            width: 30px;
            font-size: 25px;
            color: rgba(85, 85, 85);
        }

        #whowin {
            position: relative;
            height: 30px;
            width: 40px;
            font-size: 25px;
            color: rgba(85, 85, 85);
        }


        #count_OX {
            position: absolute;
            top: 210px;
            left: 650px;
            font-size: 25px;
            color: rgba(85, 85, 85);
        }

        #img_tie {
            position: absolute;
            top: 0;
            left: 580px;
            height: 275px;
            opacity: 0;
            transition: 0.5s;
        }

        #img_OX_O {
            position: absolute;
            top: 60px;
            left: 570px;
            height: 150px;
            transition: 0.5s;
            opacity: 0.1;
        }

        #img_OX_X {
            position: absolute;
            top: 60px;
            left: 721px;
            height: 150px;
            transition: 0.5s;
            opacity: 0.1;
        }
    </style>
</head>

<body>
    <p id="Next_player">Next player: <input id="player" type="text" value="X" disabled></p>

    <div class='ary' id="block_1">
        <input class="btn_class" id="button_c1_1" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c1_2" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c1_3" type="button" onclick="btnclick(this.id)">
        <br>
        <input class="btn_class" id="button_c1_4" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c1_5" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c1_6" type="button" onclick="btnclick(this.id)">
        <br>
        <input class="btn_class" id="button_c1_7" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c1_8" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c1_9" type="button" onclick="btnclick(this.id)">
    </div>
    <div class='ary' id="block_2" style="margin: 10px;">
        <input class="btn_class" id="button_c2_1" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c2_2" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c2_3" type="button" onclick="btnclick(this.id)">
        <br>
        <input class="btn_class" id="button_c2_4" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c2_5" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c2_6" type="button" onclick="btnclick(this.id)">
        <br>
        <input class="btn_class" id="button_c2_7" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c2_8" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c2_9" type="button" onclick="btnclick(this.id)">
    </div>
    <div class='ary' id="block_3">
        <input class="btn_class" id="button_c3_1" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c3_2" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c3_3" type="button" onclick="btnclick(this.id)">
        <br>
        <input class="btn_class" id="button_c3_4" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c3_5" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c3_6" type="button" onclick="btnclick(this.id)">
        <br>
        <input class="btn_class" id="button_c3_7" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c3_8" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c3_9" type="button" onclick="btnclick(this.id)">
    </div>
    <br>
    <div class='ary' id="block_4">
        <input class="btn_class" id="button_c4_1" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c4_2" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c4_3" type="button" onclick="btnclick(this.id)">
        <br>
        <input class="btn_class" id="button_c4_4" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c4_5" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c4_6" type="button" onclick="btnclick(this.id)">
        <br>
        <input class="btn_class" id="button_c4_7" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c4_8" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c4_9" type="button" onclick="btnclick(this.id)">
    </div>
    <div class='ary' id="block_5" style="margin: 10px;">
        <input class="btn_class" id="button_c5_1" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c5_2" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c5_3" type="button" onclick="btnclick(this.id)">
        <br>
        <input class="btn_class" id="button_c5_4" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c5_5" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c5_6" type="button" onclick="btnclick(this.id)">
        <br>
        <input class="btn_class" id="button_c5_7" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c5_8" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c5_9" type="button" onclick="btnclick(this.id)">
    </div>
    <div class='ary' id="block_6">
        <input class="btn_class" id="button_c6_1" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c6_2" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c6_3" type="button" onclick="btnclick(this.id)">
        <br>
        <input class="btn_class" id="button_c6_4" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c6_5" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c6_6" type="button" onclick="btnclick(this.id)">
        <br>
        <input class="btn_class" id="button_c6_7" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c6_8" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c6_9" type="button" onclick="btnclick(this.id)">
    </div>
    <br>
    <div class='ary' id="block_7">
        <input class="btn_class" id="button_c7_1" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c7_2" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c7_3" type="button" onclick="btnclick(this.id)">
        <br>
        <input class="btn_class" id="button_c7_4" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c7_5" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c7_6" type="button" onclick="btnclick(this.id)">
        <br>
        <input class="btn_class" id="button_c7_7" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c7_8" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c7_9" type="button" onclick="btnclick(this.id)">
    </div>
    <div class='ary' id="block_8" style="margin: 10px;">
        <input class="btn_class" id="button_c8_1" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c8_2" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c8_3" type="button" onclick="btnclick(this.id)">
        <br>
        <input class="btn_class" id="button_c8_4" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c8_5" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c8_6" type="button" onclick="btnclick(this.id)">
        <br>
        <input class="btn_class" id="button_c8_7" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c8_8" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c8_9" type="button" onclick="btnclick(this.id)">
    </div>
    <div class='ary' id="block_9">
        <input class="btn_class" id="button_c9_1" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c9_2" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c9_3" type="button" onclick="btnclick(this.id)">
        <br>
        <input class="btn_class" id="button_c9_4" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c9_5" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c9_6" type="button" onclick="btnclick(this.id)">
        <br>
        <input class="btn_class" id="button_c9_7" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c9_8" type="button" onclick="btnclick(this.id)">
        <input class="btn_class" id="button_c9_9" type="button" onclick="btnclick(this.id)">
    </div>
    </p>
    <p id="count_OX">X:<input id="win_X" type="text" value="0" disabled> O:<input id="win_O" type="text" value="0"
            disabled></p>
    <p id="win_arrow">WIN → <input id="whowin" type="text" disabled></p>
    <button id="restartbtn" onclick="restart()">RESTART</button>
    <button id="start" onclick="start()">START</button>
    <img id="img_tie" src="./img/tie.png" alt="">
    <img id="img_OX_O" src="./img/O.png" alt="">
    <img id="img_OX_X" src="./img/X.png" alt="">

    <script>
        $(".btn_class").val(" ")
        var charactor = ['X', 'O'];
        var spot = 0;
        var result = document.getElementsByClassName('btn_class');
        var ary = [];
        for (i = 1; i < 10; i++) {
            for (j = 1; j < 10; j++) {
                ary.push(document.getElementById(`button_c${i}_${j}`))
            }
        }
        // 自動點選
        var inter, list, new_list;
        function start() {
            $("#start").prop('disabled', true);
            // list = [ [ 1_1 ~ 1_9 ] , [ 2_1 ~ 2_9 ] , ... ]
            // new_list = [ [ 0~8 ] , [ 0~8 ] , ... ]
            if (list == undefined) {
                list = [];
                new_list = []
                for (i = 0; i < 9; i++) {
                    list[i] = [];
                    new_list[i] = [];
                }
                for (j = 1; j < 10; j++) {
                    for (i = 0; i < 9; i++) {
                        list[i].push(document.getElementById(`button_c${i + 1}_${j}`));
                        new_list[i].push(j - 1);
                    }
                }
            }
            var out = Math.floor(Math.random() * 9),
                inner = Math.floor(Math.random() * 9),
                other;
            inter = setInterval(function () {
                list[out][new_list[out][inner]].click();
                other = new_list[out][inner];
                new_list[out].splice(inner, 1);
                out = other;
                i = new_list[out].length;
                inner = Math.floor(Math.random() * i);
                if (document.getElementById('whowin').value != "") {
                    clearInterval(inter);
                }
            }, 500)
        }

        function btnclick(id) {
            temp = document.getElementById(id);
            // X、O輪流、Next player顯示
            if (temp.value == " ") {
                temp.value = charactor[spot];
                spot = 1 - spot;
                document.getElementById("player").value = charactor[spot];
                temp.onclick = " ";
            }
            // 全部disabled、變淡
            for (i = 0; i < 81; i++) {
                result[i].setAttribute('disabled', 'true');
                result[i].setAttribute("style", "background-color: rgba(226, 220, 220, 0.788);");
            }
            // 對應到的大格移除disabled、變淡，不能點的disabled、變淡
            var high = document.getElementById(id).id.slice(10, 11)
            for (i = (high - 1) * 9; i < high * 9; i++) {
                result[i].removeAttribute('disabled', 'true');
                result[i].removeAttribute("style", "background-color: rgba(226, 220, 220, 0.788);");
                for (j = 0; j < 81; j++) {
                    if (result[j].value != " ") {
                        result[j].setAttribute('disabled', 'true');
                        result[j].setAttribute("style", "background-color: rgba(226, 220, 220, 0.788);");
                    }
                }
            }
            // 其中一大格全部有值則全部disabled、變淡
            for (i = 0; i < 9; i++) {
                if (result[0 + 9 * i].value != " " && result[1 + 9 * i].value != " " && result[2 + 9 * i].value != " " && result[3 + 9 * i].value != " " && result[4 + 9 * i].value != " " && result[5 + 9 * i].value != " " && result[6 + 9 * i].value != " " && result[7 + 9 * i].value != " " && result[8 + 9 * i].value != " ") {
                    for (j = 0; j < 81; j++) {
                        result[j].onclick = " ";
                        result[j].setAttribute('disabled', 'true');
                        result[j].setAttribute("style", "background-color: rgba(226, 220, 220, 0.788);");
                    }
                }
            }

            winner();
            // 顯示贏家
            for (i = 0; i < 9; i++) {
                if (result[0 + 9 * i].value != " " && result[1 + 9 * i].value != " " && result[2 + 9 * i].value != " " && result[3 + 9 * i].value != " " && result[4 + 9 * i].value != " " && result[5 + 9 * i].value != " " && result[6 + 9 * i].value != " " && result[7 + 9 * i].value != " " && result[8 + 9 * i].value != " " && (document.getElementById("win_X").value > document.getElementById("win_O").value)) {
                    document.getElementById("whowin").value = "X"
                    $(img_OX_X).css("opacity", "1");
                } else if (result[0 + 9 * i].value != " " && result[1 + 9 * i].value != " " && result[2 + 9 * i].value != " " && result[3 + 9 * i].value != " " && result[4 + 9 * i].value != " " && result[5 + 9 * i].value != " " && result[6 + 9 * i].value != " " && result[7 + 9 * i].value != " " && result[8 + 9 * i].value != " " && (document.getElementById("win_X").value < document.getElementById("win_O").value)) {
                    document.getElementById("whowin").value = "O"
                    $(img_OX_O).css("opacity", "1");
                } else if (result[0 + 9 * i].value != " " && result[1 + 9 * i].value != " " && result[2 + 9 * i].value != " " && result[3 + 9 * i].value != " " && result[4 + 9 * i].value != " " && result[5 + 9 * i].value != " " && result[6 + 9 * i].value != " " && result[7 + 9 * i].value != " " && result[8 + 9 * i].value != " " && (document.getElementById("win_X").value == document.getElementById("win_O").value)) {
                    document.getElementById("whowin").value = "TIE"
                    $(img_tie).css("opacity", "1");
                }
            }

            // 贏家出現則Next player空白
            if (document.getElementById('whowin').value != "") {
                document.getElementById("player").value = "";
                $("#start").prop('disabled', true);
            }
        }

        function restart() {
            $(".btn_class").val(" ");
            document.getElementById("win_X").value = "0";
            document.getElementById("win_O").value = "0";
            document.getElementById("whowin").value = "";
            for (i = 0; i < result.length; i++) {
                result[i].removeAttribute('disabled');
                result[i].removeAttribute("style", "background-color: rgba(226, 220, 220, 0.788);");
            };
            this.spot = 0;
            for (i = 0; i < result.length; i++) {
                result[i].setAttribute('onclick', 'btnclick(this.id);');
                result[i].onclick = function () { btnclick(this.id); };
            }
            $(img_OX_X).css("opacity", "0.1");
            $(img_OX_O).css("opacity", "0.1");
            $(img_tie).css("opacity", "0");
            document.getElementById("player").value = "X";
            $("#start").prop('disabled', false);
            clearInterval(inter);
            list = undefined;
        }

        function winner() {
            var ary_new = []
            for (i = 0; i < 9; i++) {
                ary_new[i * 8] = [0 + i * 9, 1 + i * 9, 2 + i * 9];
                ary_new[i * 8 + 1] = [3 + i * 9, 4 + i * 9, 5 + i * 9];
                ary_new[i * 8 + 2] = [6 + i * 9, 7 + i * 9, 8 + i * 9];
                ary_new[i * 8 + 3] = [0 + i * 9, 3 + i * 9, 6 + i * 9];
                ary_new[i * 8 + 4] = [1 + i * 9, 4 + i * 9, 7 + i * 9];
                ary_new[i * 8 + 5] = [2 + i * 9, 5 + i * 9, 8 + i * 9];
                ary_new[i * 8 + 6] = [0 + i * 9, 4 + i * 9, 8 + i * 9];
                ary_new[i * 8 + 7] = [2 + i * 9, 4 + i * 9, 6 + i * 9];
            }
            var point_X = 0
            var point_O = 0
            for (i = 0; i < ary_new.length; i++) {
                if (ary[ary_new[i][0]].value == ary[ary_new[i][1]].value && ary[ary_new[i][1]].value == ary[ary_new[i][2]].value && ary[ary_new[i][0]].value != " ") {
                    if (ary[ary_new[i][0]].value == "X") {
                        point_X++;
                    } else {
                        point_O++;
                    }
                }
            }
            document.getElementById("win_X").value = point_X;
            document.getElementById("win_O").value = point_O;
        }
    </script>
</body>

</html>